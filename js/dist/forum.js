(()=>{var t={n:o=>{var e=o&&o.__esModule?()=>o.default:()=>o;return t.d(e,{a:e}),e},d:(o,e)=>{for(var s in e)t.o(e,s)&&!t.o(o,s)&&Object.defineProperty(o,s,{enumerable:!0,get:e[s]})},o:(t,o)=>Object.prototype.hasOwnProperty.call(t,o)};(()=>{"use strict";const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("leomahdi/flarum-wall",(function(){console.log("[leomahdi/flarum-wall] Hello, forum and admin!")}));const e=flarum.core.compat["forum/app"];var s=t.n(e);const n=flarum.core.compat["forum/components/UserPage"];var r=t.n(n);const i=flarum.core.compat["common/extend"];function a(t,o){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,o){return t.__proto__=o,t},a(t,o)}function c(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,a(t,o)}const l=flarum.core.compat["common/components/Button"];var u=t.n(l);const d=flarum.core.compat["forum/components/DiscussionComposer"];var p=t.n(d);const f=flarum.core.compat["common/utils/Stream"];var h=t.n(f),v=function(t){function o(){return t.apply(this,arguments)||this}c(o,t),o.initAttrs=function(o){t.initAttrs.call(this,o),o.titlePlaceholder="Create a thread ! ",o.submitLabel="Create a thread  ! "};var e=o.prototype;return e.oninit=function(o){t.prototype.oninit.call(this,o),this.fields={title:h()(""),content:h()(""),tags:h()([]),discussions_wall:h()(1)}},e.data=function(){var o=t.prototype.data.call(this);return o.discussions_wall=this.fields.discussions_wall(),o},e.onsubmit=function(){this.loading=!0;var t=this.composer.fields.title(),o=this.composer.fields.content();if(t&&o){var e=this.data();console.log(e),s().store.createRecord("discussions").save(e).then((function(t){s().redrawHandler&&s().redrawHandler(t.id()),s().composer.hide(),console.log("Discussion created successfully:",t)})).catch((function(t){s().composer.hide(),console.error("Error creating discussion:",t),alert("There was an error creating the discussion.")}))}else alert("Please fill in both the title and content.")},o}(p()),g=function(){function t(){}var o=t.prototype;return o.component=function(){return u().component({icon:"fas fa-pen",className:"Button Button--primary IndexPage-newDiscussion",onclick:this.action.bind(this)},"Create a thread !")},o.action=function(t){return t.preventDefault(),new Promise((function(o,e){return s().session.user?(s().composer.load(v,{user:s().session.user,titlePlaceholder:s().translator.trans("core.forum.composer_discussion.title_placeholder"),submitLabel:s().translator.trans("core.forum.composer_discussion.submit_button")}),s().composer.show(),o(t)):e()}))},t}();const w=flarum.core.compat["forum/components/PostStream"];var y=t.n(w);const b=flarum.core.compat["forum/components/DiscussionPage"];var D=function(t){function o(o,e){var s;return(s=t.call(this)||this).selectedDiscussion=void 0,s.stream=void 0,s.selectedDiscussion=o,s.stream=e,s}return c(o,t),o.prototype.view=function(){return m("div",{className:"DiscussionPage-stream"},m(y(),{discussion:this.selectedDiscussion,stream:this.stream,onPositionChange:this.positionChanged.bind(this)}))},o}(t.n(b)());const P=flarum.core.compat["common/components/LoadingIndicator"];var _=t.n(P);const B=flarum.core.compat["forum/states/PostStreamState"];var I=t.n(B),U=function(t){function o(){var o;return(o=t.call(this)||this).composeButton=void 0,o.postsUserWall=void 0,o.loading=!1,o.selectedDiscussion=void 0,o.stream=void 0,o.getIdThread(),o}c(o,t);var e=o.prototype;return e.oninit=function(o){var e=this;t.prototype.oninit.call(this,o),this.loadUser(m.route.param("username")),this.composeButton=new g,s().redrawHandler=function(t){e.loadDiscussion(t)},this.loading=!0},e.requestParams=function(){return{bySlug:!0}},e.getIdThread=function(){var t=this,o=m.route.param("username");this.loading=!0,s().request({method:"GET",url:s().forum.attribute("apiUrl")+"/wall-discussion-id?username="+o}).then((function(o){var e;console.log("Discussions: ID",o),t.loading=!1,null!=o&&null!=(e=o.data)&&e.id?t.loadDiscussion(o.data.id):m.redraw()})).catch((function(o){console.error("Error fetching discussions:",o),t.loading=!1}))},e.loadDiscussion=function(t){var o=this,e=[];this.loading=!0;var n=this.requestParams();s().store.find("discussions",t,n).then((function(t){if(o.loading=!1,t.payload&&t.payload.included){var n=t.id();e=t.payload.included.filter((function(t){return"posts"===t.type&&t.relationships&&t.relationships.discussion&&!Array.isArray(t.relationships.discussion.data)&&t.relationships.discussion.data.id===n})).map((function(t){return s().store.getById("posts",t.id)})).sort((function(t,o){return t.number()-o.number()})).slice(0,20)}o.selectedDiscussion=t,o.stream=new(I())(t,e),o.postsUserWall=new D(o.selectedDiscussion,o.stream),m.redraw()})).catch((function(t){console.error("Error loading discussions:",t),o.loading=!1,m.redraw()}))},e.show=function(o){t.prototype.show.call(this,o)},e.content=function(){return this.loading?m(_()):m("div",{className:"WallUserPage-container"},m("div",{className:"DiscussionList-container"},this.selectedDiscussion&&this.stream?this.postsUserWall&&this.postsUserWall.view():this.composeButton&&this.composeButton.component()))},o}(r());s().initializers.add("leomahdi/flarum-wall",(function(){console.log("[leomahdi/flarum-wall] Hello, forum!"),console.log("[leomahdi/flarum-wall] Initializing extension..."),s().routes.userWall={path:"/u/:username/wall",component:U},(0,i.extend)(r().prototype,"navItems",(function(t){var o;t.add("wall",m("a",{class:"UserPage-navItem",active:"true",onclick:function(){m.route.set("/u/"+m.route.param("username")+"/wall")}},m("i",{class:"icon Wall-icon fas fa-user  Button-icon"}),m("span",{class:"Button-label"},"Wall")),110);var e,s="/u/"+m.route.param("username")+"/wall";m.route.get().toString().trim()==s.trim()?null==(e=document.querySelector(".item-wall"))||e.classList.add("active"):null==(o=document.querySelector(".item-wall"))||o.classList.remove("active")}))}))})(),module.exports={}})();
//# sourceMappingURL=forum.js.map